# Reactoring Chapter 1

## ë¦¬íŒ©í† ë§ì´ë€

ë¦¬íŒ©í† ë§ì€ ê²‰ìœ¼ë¡œ ë“œëŸ¬ë‚˜ëŠ” ì½”ë“œì˜ ê¸°ëŠ¥ (ê²‰ë³´ê¸°ì˜ ë™ì‘)ì€ ë°”ê¾¸ì§€ ì•Šìœ¼ë©´ì„œ ë‚´ë¶€ êµ¬ì¡°ë¥¼ ê°œì„ í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì†Œí”„íŠ¸ì›¨ì–´ ì‹œìŠ¤í…œì„ ìˆ˜ì •í•˜ëŠ” ê³¼ì •ì´ë‹¤.

> í”„ë¡œê·¸ë¨ì´ ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê¸°ì— í¸í•œ êµ¬ì¡°ê°€ ì•„ë‹ˆë¼ë©´, ë¨¼ì € ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê¸° ì‰¬ìš´ í˜•íƒœë¡œ ë¦¬íŒ©í† ë§í•˜ê³  ë‚˜ì„œ ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•œë‹¤.

## ê³¼ì •

0. ë¦¬íŒ©í† ë§í•˜ê¸° ì „ì— ì œëŒ€ë¡œ ëœ í…ŒìŠ¤íŠ¸ë¶€í„° ë§ˆë ¨
1. ì›ë³¸ í•¨ìˆ˜ë¥¼ ì¤‘ì²© í•¨ìˆ˜ ì—¬ëŸ¬ê°œë¡œ ë‚˜ëˆ„ê¸°
2. ê³„ì‚°ì½”ë“œì™€ ì¶œë ¥ ì½”ë“œ ë¶„ë¦¬ (ë‹¨ê³„ ìª¼ê°œê¸°)
3. ê³„ì‚° ë¡œì§ -> ë‹¤í–¥ì„±ìœ¼ë¡œ í‘œí˜„ 

<br />

## 0. ë¦¬íŒ©í† ë§ í•˜ê¸°ì „ ì œëŒ€ë¡œ ëœ í…ŒìŠ¤íŠ¸ë¶€í„° ë§ˆë ¨

ì•„ë¬´ë¦¬ ê°„ë‹¨í•œ ìˆ˜ì •ì´ë¼ë„ ë¦¬íŒ©í„°ë§ í›„ì—ëŠ” í•­ìƒ í…ŒìŠ¤íŠ¸í•˜ëŠ” ìŠµê´€ì„ ë“¤ì´ëŠ” ê²ƒì´ ë°”ëŒì§í•˜ë‹¤.
ì‚¬ëŒì€ ì‹¤ìˆ˜í•˜ê¸° ë§ˆë ¨ì´ë‹¤.

ë¦¬íŒ©í„°ë§ì€ í”„ë¡œê·¸ë¨ ìˆ˜ì •ì„ ì‘ì€ ë‹¨ê³„ë¡œ ë‚˜ëˆ  ì§„í–‰í•œë‹¤. ê·¸ë˜ì„œ ì¤‘ê°„ì— ì‹¤ìˆ˜í•˜ë”ë¼ë„ ë²„ê·¸ë¥¼ ì‰½ê²Œ ì°¾ì„ ìˆ˜ ìˆë‹¤.

í•˜ë‚˜ì˜ ë¦¬íŒ©í„°ë§ì„ ë¬¸ì œì—†ì´ ëë‚¼ ë•Œë§ˆë‹¤ ì»¤ë°‹ì„ í•œë‹¤. ê·¸ë˜ì•¼ ì¤‘ê°„ì— ë¬¸ì œê°€ ìƒê¸°ë”ë¼ë„ ì´ì „ì˜ ì •ìƒ ìƒíƒœë¡œ ì‰½ê²Œ ëŒì•„ê°ˆ ìˆ˜ ìˆë‹¤.

ì»´íŒŒì¼ -> í…ŒìŠ¤íŠ¸ -> ì»¤ë°‹

ë³€ìˆ˜ì˜ ì´ë¦„ì´ ë°”ë€” ë•Œë§ˆë‹¤ ì»´íŒŒì¼-í…ŒìŠ¤íŠ¸-ì»¤ë°‹ 

<br />

## 1. ì›ë³¸ í•¨ìˆ˜ë¥¼ ì¤‘ì²© í•¨ìˆ˜ ì—¬ëŸ¬ê°œë¡œ ë‚˜ëˆ„ê¸°

> ì½”ë“œë¥¼ ë¶„ì„í•´ì„œ ì–»ì€ ì •ë³´ëŠ” íœ˜ë°œì„±ì´ ë†’ê¸°ë¡œ ì•…ëª… ë†’ì€ ì €ì¥ ì¥ì¹˜ì¸ ë‚´ ë¨¸ë¦¿ì†ì— ê¸°ë¡ë˜ë¯€ë¡œ, ìŠì§€ ì•Šìœ¼ë ¤ë©´ ì¬ë¹¨ë¦¬ ì½”ë“œì— ë°˜ì˜í•´ì•¼ í•œë‹¤. ë‹¤ì‹œ ë¶„ì„í•˜ì§€ ì•Šì•„ë„ ì½”ë“œ ìŠ¤ìŠ¤ë¡œê°€ ìì‹ ì´ í•˜ëŠ” ì¼ì´ ë¬´ì—‡ì¸ì§€ ì´ì•¼ê¸° í•  ê²ƒì´ë‹¤.

ì¶”ì¶œí•œ í•¨ìˆ˜ë‚´ì—ì„œ ë³€ìˆ˜ëª…ì„ ë” ëª…í™•í•˜ê²Œ ë³€ê²½í•œë‹¤. ë§¤ê°œë³€ìˆ˜ì— ì´ë¦„ì— ì ‘ë‘ì–´ë¡œ íƒ€ì… ì´ë¦„ì„ ì ëŠ”ë°, ã…‡ì§€ê¸ˆì²˜ëŸ¼ ë§¤ê°œë³€ìˆ˜ì˜ ì—­í• ì´ ëšœë ·í•˜ì§€ ì•Šì„ ë•ŒëŠ” ë¶€ì • ê´€ì‚¬(a/an)ë¥¼ ë¶™ì¸ë‹¤.

> ì»´í“¨í„°ê°€ ì´í•´í•˜ëŠ” ì½”ë“œëŠ” ë°”ë³´ë„ ì‘ì„±í•  ìˆ˜ ìˆë‹¤. ì‚¬ëŒì´ ì´í•´í• ë„ë¡ ì‘ì„±í•˜ëŠ” í”„ë¡œê·¸ë˜ë¨¸ê°€ ì§„ì •í•œ ì‹¤ë ¥ìë‹¤.

<br />

### ì„ì‹œ ë³€ìˆ˜ë¥¼ ì§ˆì˜ í•¨ìˆ˜ë¡œ ë°”ê¾¸ê¸°

ì„ì‹œ ë³€ìˆ˜ë“¤ ë•Œë¬¸ì— ë¡œì»¬ ë²”ìœ„ì— ì¡´ì¬í•˜ëŠ” ì´ë¦„ì´ ëŠ˜ì–´ë‚˜ì„œ ì¶”ì¶œ ì‘ì—…ì´ ë³µì¡í•´ ì§€ê¸° ë•Œë¬¸ì— ë³€ê²½í•œë‹¤.

```diff
- const play = plays[perf.playID];
+ function playFor(aPerformance) {
+ 	return plays[aPerformance.playID];
+ }
+ const play = playFor(perf);
```

<br />

### ë³€ìˆ˜ ì¸ë¼ì¸í•˜ê¸°

```diff
- const play = playFor(perf);
+ let thisAmount = amountFor(perf, playFor(perf));
```

<br />

### í•¨ìˆ˜ì„ ì–¸ ë°”ê¾¸ê¸°

```diff
- let thisAmount = amountFor(perf, playFor(perf));
+ let thisAmount = amountFor(perf);
- function amountFor(aPerformance, play) {
+ function amountFor(aPerformance) {
+ siwtch (playFor(aPerformance.type)) {
```

ì§€ì—­ë³€ìˆ˜ë¥¼ ì œê±°í•´ì„œ ì–»ëŠ” ê°€ì¥ í° ì¥ì ì€ ì¶”ì¶œ ì‘ì—…ì´ í›¨ì”¬ ì‰¬ì›Œì§„ë‹¤ëŠ” ê²ƒì´ë‹¤.

ìœ íš¨ë²”ìœ„ë¥¼ ì‹ ê²½ ì¨ì•¼ í•  ëŒ€ìƒì´ ì¤„ì–´ë“¤ê¸° ë•Œë¬¸ì´ë‹¤. ì¶”ì¶œ ì‘ì—… ì „ì—ëŠ” ê±°ì˜ í•­ìƒ ì§€ì—­ ë³€ìˆ˜ë¶€í„° ì œê±°í•œë‹¤.

<br />

### ë°˜ë³µë¬¸ ìª¼ê°œê¸°

ë°˜ë³µë¬¸ì˜ ì¤‘ë³µì€ ì„±ëŠ¥ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì´ ë¯¸ë¯¸í•  ë•Œê°€ ë§ë‹¤.

> ë¦¬íŒ©í„°ë§ìœ¼ë¡œ ì¸í•œ ì„±ëŠ¥ ë¬¸ì œì— ëŒ€í•œ ë‚´ ì¡°ì–¸ì€ 'íŠ¹ë³„í•œ ê²½ìš°ê°€ ì•„ë‹ˆë¼ë©´ ì¼ë‹¨ ë¬´ì‹œí•˜ë¼'ëŠ” ê²ƒì´ë‹¤.

<br />

### ë¬¸ì¥ ìŠ¬ë¼ì´ë“œí•˜ê¸°

ë³€ìˆ˜ ì„ ì–¸(ì´ˆê¸°í™”)ì„ ë°˜ë³µë¬¸ ì•ìœ¼ë¡œ ì´ë™

```js
let volumeCredits = 0;
for (let perf of invoice.performances) {
  volumeCredits += volumeCreditsFor(perf);
}
```

<br />

## 2. ê³„ì‚°ì½”ë“œì™€ ì¶œë ¥ ì½”ë“œ ë¶„ë¦¬ (ë‹¨ê³„ ìª¼ê°œê¸°)

ì²«ë²ˆì§¸ ë‹¨ê³„ì—ì„œ ë‘ë²ˆì§¸ ë‹¨ê³„ë¡œ ì „ë‹¬í•  ì¤‘ê°„ ë°ì´í„° êµ¬ì¡°ë¥¼ ìƒì„±í•œë‹¤.

```js
function enrichPerformance(aPerformance) {
  const result = Object.assign({}, aPerformance); // ì–•ì€ ë³µì‚¬ ìˆ˜í–‰
  return result;
}
```

ë§¤ê°œë³€ìˆ˜ë¡œ ê±´ë„¤ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ì§€ ì•ŠëŠ” í¸ì´ë‹¤. ê°€ë³€(mutable) ë°ì´í„°ëŠ” ê¸ˆë°© ìƒí•˜ê¸° ë•Œë¬¸ì— ë°ì´í„°ë¥¼ ìµœëŒ€í•œ ë¶ˆë³€(immutable) ì²˜ëŸ¼ ì·¨ê¸‰í•œë‹¤.

<br />

**createStatementData.js**


```js
export default function createStatementData(invoice, plays) { 
  const result = {}
  result.customer = invoice.customer; 
  result.performances = invoice.performances.map(enrichPerformance);
  result.totalAmount = totalAmount(result);
  result.totalVolumeCredits = totalVolumeCredits(result);
  return result;
  // ...
}
```

**statement.js** 

```js
function htmlStatement(invoice, plays) {
  return renderHtml(createStatementData(invoice, plays));
}

function renderHtml(data) {
  let result = `<h1>Statement for ${data.customer}</h1>\n`;
  result += "<table>\n";
  result += "<tr><th>play</th><th>seats</th><th>cost</th></tr>";
  for (let perf of data.performances) {
    result += `<tr><td>${perf.play.name}</td><td>${perf.audience}</td>`;
    result += `<td>${usd(perf.amount)}</td></tr>\n`;
  }
  result += "</table>\n";
  result += `<p>Amount owed is <em>${usd(data.totalAmount)}</em></p>\n`;
  result += `<p>You earned <em>${data.totalVolumeCredits}</em> credits</p>\n`;
  return result;
}
```

ê³„ì‚°í•˜ëŠ” ë¶€ë¶„ê³¼ ì¶œë ¥í•˜ëŠ” ë¶€ë¶„ì„ ë¶„ë¦¬í•˜ì—¬ ëª¨ë“ˆí™”í•˜ë©´ ê° ë¶€ë¶„ì´ í•˜ëŠ” ì¼ê³¼ ê·¸ ë¶€ë¶„ë“¤ì´ ë§ë¬¼ë ¤ ëŒì•„ê°€ëŠ” ê³¼ì •ì„ íŒŒì•…í•˜ê¸° ì‰¬ì›Œì§„ë‹¤. ëª¨ë“ˆí™” ë•ë¶„ì— ê³„ì‚° ì½”ë“œë¥¼ ì¤‘ë³µí•˜ì§€ ì•Šê³ ë„ HTML ë²„ì „ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤. 

<br />

## 4. ë‹¤í˜•ì„±ì„ í™œìš”í•´ ê³„ì‚° ì½”ë“œ ì¬êµ¬ì„±í•˜ê¸°

ì—°ê·¹ ì¥ë¥´ë¥¼ ì¶”ê°€í•˜ê³  ì¥ë¥´ë§ˆë‹¤ ê³µì—°ë£Œì™€ ì ë¦½ í¬ì¸íŠ¸ ê³„ì‚°ë²•ì„ ë‹¤ë¥´ê²Œ ì§€ì •í•˜ë„ë¡ ê¸°ëŠ¥ì„ ìˆ˜ì •í•´ë³´ì.

ê°ì²´ì§€í–¥ì˜ í•µì‹¬ íŠ¹ì„±ì¸ `ë‹¤í˜•ì…©(polymorphism)`ì„ í™œìš©í•˜ëŠ” ê²ƒ

**ìƒì† ê³„ì¸µ** ì„ êµ¬ì„±í•´ì„œ í¬ê·¹ ì„œë¸Œí´ë˜ìŠ¤ì™€ ë¹„ê·¹ ì„œë¸Œí´ë˜ìŠ¤ê°€ ê°ìì˜ êµ¬ì²´ì ì¸ ê³„ì‚° ë¡œì§ì„ ì •ì˜í•˜ëŠ” ê²ƒ 

<br />

### ë¡œì§ì„ í´ë˜ìŠ¤ë¡œ ë³€ê²½

ìµœìƒìœ„ í´ë˜ìŠ¤
```js
class PerformanceCalculator {
  constructor(aPerformance, aPlay) {
    this.performance = aPerformance;
    this.play = aPlay;
  }
}
```

ë‹¤í˜•ì„±ì„ ì§€ì›í•˜ê¸° ìœ„í•´ í´ë˜ìŠ¤ë¡œ ë³€ê²½

<br />

### ìƒì„±ìë¥¼ íŒ©í„°ë¦¬ í•¨ìˆ˜ë¡œ ë°”ê¾¸ê¸°

**createStatementData í•¨ìˆ˜**

```diff
function enrichPerformance(aPerformance) {
-	const claculator = new PerformanceCalculator(aPerformance, playFor(aPerformance));
+ const claculater = const calculator = createPerformanceCalculator(aPerformance, playFor(aPerformance));
}
```

**ìµœìƒìœ„**

```js
function createPerformanceCalculator(aPerformance, aPlay) {
  switch (aPlay.type) {
    case "tragedy":
      return new TragedyCalculator(aPerformance, aPlay);
    case "comedy":
      return new ComedyCalculator(aPerformance, aPlay);
    default:
      throw new Error(`unknown type: ${aPlay.type}`);
  }
  
class TragedyCalculator extends PerformanceCalculator {
}
class ComedyCalculator extends PerformanceCalculator {
}
```

ì„œë¸Œí´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ìƒì„±ì ëŒ€ì‹  í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë„ë¡ ë°”ê¿”ì•¼ í•œë‹¤. ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œëŠ” ìƒì„±ìê°€ ì„œë¸Œí´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì´ë‹¤.

<br />

### ### ì¡°ê±´ë¶€ ë¡œì§ì„ ë‹¤í˜•ì„±ìœ¼ë¡œ ë°”ê¾¸ê¸°

```js
class PerformanceCalculator {
  constructor(aPerformance, aPlay) {
    this.performance = aPerformance;
    this.play = aPlay;
  }

  get amount() {
    throw new Error(`subclass responsibility`);
  }
}
```

amountë¥¼ ì‚­ì œí•˜ì§€ ì•Šê³  errorì²˜ë¦¬í•˜ëŠ” ì„¼ìŠ¤.. ğŸ‘

<br />

```js
class ComedyCalculator extends PerformanceCalculator {
  get amount() {
    let result = 30000;
    // code
  }
  get volumeCredits() {
    return super.volumeCredits + Math.floor(this.performance.audience / 5);
  }
}
```

[**super**](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Operators/super) í‚¤ì›Œë“œëŠ” ë¶€ëª¨ ì˜¤ë¸Œì íŠ¸ì˜ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ ì‚¬ìš©ëœë‹¤.

<br />

```js
 function enrichPerformance(aPerformance) {
    const calculator = createPerformanceCalculator(aPerformance, playFor(aPerformance));
    const result = Object.assign({}, aPerformance);
    result.amount = calculator.amount;
    // code
    return result;
  }
```

ê²Œí„° ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ì½”ë“œì™€ ì¼ë°˜ì ì¸ ë°ì´í„° ì ‘ê·¼ ì½”ë“œì˜ ëª¨ì–‘ì´ ë˜‘ê°™ë‹¤. `calculator.amount`

ê³„ì‚°ê¸° ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•˜ëŠ” ë°©ì‹ê³¼ ê°ê°ì˜ ì¶œë ¥ ê°’ìœ¼ë¡œ ì§ì ‘ ê³„ì‚°í•˜ëŠ” ë°©ì‹ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•  ë•Œ ë‚˜ëŠ” ê²°ê³¼ë¡œ ë‚˜ì˜¨ ë°ì´í„° êµ¬ì¡°ë¥¼ ëˆ„ê°€ ì‚¬ìš©í•˜ëŠ”ê°€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê²°ì •í•œë‹¤.

<br />

## ë§ˆë¬´ë¦¬

> ì¢‹ì€ ì½”ë“œë¥¼ ê°€ëŠ í•˜ëŠ” í™•ì‹¤í•œ ë°©ë²•ì€ 'ì–¼ë§ˆë‚˜ ìˆ˜ì •í•˜ê¸° ì‰¬ìš´ê°€'ë‹¤

ë¦¬íŒ©í† ë§ì„ íš¨ê³¼ì ìœ¼ë¡œ í•˜ëŠ” í•µì‹¬ì€, ë‹¨ê³„ë¥¼ ì˜ê²Œ ë‚˜ëˆ ì•¼ ë” ë¹ ë¥´ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆê³ , ì½”ë“œëŠ” ì ˆëŒ€ ê¹¨ì§€ì§€ ì•Šìœ¼ë©°, ì´ëŸ¬í•œ ì‘ì€ ë‹¨ê³„ë“¤ì´ ë¨¸ì—¬ì„œ ìƒë‹¹íˆ í° ë³€í™”ë¥¼ ì´ë£° ìˆ˜ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ê¹¨ë‹«ëŠ” ê²ƒì´ë‹¤.

chapter 1ì˜ ë‚´ìš©ì€ clean architectureê°€ ë§ì´ ìƒê°ë‚˜ëŠ” ë‚´ìš©ì´ì—ˆë‹¤.

ê·¸ ì±…ì´ ê°•ì¡°í•˜ëŠ” 

> ëŒì•„ëŠ” ê°€ì§€ë§Œ ìˆ˜ì •ì´ ë¶ˆê°€ëŠ¥í•œ ì½”ë“œì™€ ëŒì•„ê°€ì§„ ì•Šì§€ë§Œ ìˆ˜ì •ì´ ê°€ëŠ¥í•œ ì½”ë“œì¤‘ í›„ìë¥¼ ì„ íƒí•˜ê² ë‹¤.

ë¼ëŠ” ëŒ€ëµ ì´ëŸ° ë‰˜ì•™ìŠ¤ì˜ ê¸€ê³¼ ê°™ì€ ë§¥ë½ì¸ê±° ê°™ë‹¤.

ì‹¤ì œë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ì§€ëŠ” ì•Šì•˜ëŠ”ë°, ì´ëŸ¬í•œ ê²½í—˜ì´ ì—†ë‹¤ë³´ë‹ˆ ì§ì ‘ ì‹œê°„ë‚´ì„œ ì‘ìƒí•´ë„ ì¢‹ì•˜ì„ ê±° ê°™ë‹¤. 
